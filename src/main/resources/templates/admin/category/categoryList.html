<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      th:replace="~{/layout/adminLayout :: adminLayout(~{::title}, ~{::section}, ~{::script})}">


<title>JDong's Blog</title>

<!-- Admin Page Wrapper -->
<section>
    <div style="margin-bottom: 100px"></div>

    <div class="container">
        <h1 class="text-center">카테고리 편집</h1>
        <hr class="mb-5">
<!--        <div class="row g-0">-->
<!--            <div class="col text-right">-->
<!--                <button class="btn btn-primary">카테고리 저장</button>-->
<!--            </div>-->
<!--        </div>-->
<!--        <div class="row g-9 ms-3 mt-3 me-3" id="list-a">-->

<!--            <div class="input-group mb-3">-->
<!--                <input type="text" class="form-control" placeholder="Recipient\'s username"-->
<!--                       aria-label="Recipient\'s username" aria-describedby="button-addon2" readonly>-->
<!--                <button class="btn btn-outline-secondary" type="button">Button</button>-->
<!--                <a href="#" class="add" id="elem2">추가</a> <a href="#" class="delete">삭제</a>-->
<!--            </div>-->


<!--        </div>-->
<!--        <div class="input-group mb-3">-->
<!--            <input type="text" class="form-control" placeholder="Recipient\'s username"-->
<!--                   aria-label="Recipient\'s username" aria-describedby="button-addon2">-->
<!--            <button class="btn btn-outline-secondary" type="button">Button</button>-->
<!--        </div>-->
<!--        <div class="input-group mb-3">-->
<!--            <input type="text" class="form-control" placeholder="Recipient's username" aria-label="Recipient's username" aria-describedby="button-addon2">-->
<!--            <button class="btn btn-outline-secondary" type="button" id="button-addon2">Button</button>-->
<!--        </div>-->
        <div class="col justify-content-center my-1 mx-0">
            <form action="categoryList.html" th:action th:object="${categoryList}" method="post">
                <th:block th:each="list, s : ${categoryList.testLists}">
                    <!-- 입력 영역 -->
                    <div class="row g-9 ms-3 mt-3 me-5" id="list-a">

                        <div th:text="${s}"></div>
                        <div th:text="${s.index}"></div>
                        <div class="input-group mb-3" th:id="'parent'+${s.count}">
                            <input type="text" class="form-control" placeholder="Recipient\'s username"
                                   th:field="|${categoryList.testLists[__${s.index}__].parentCategory}|"
                                   th:id="'category'+${s.count}" readonly>
                            <button class="btn btn-outline-secondary" type="button" th:id="'modify'+${s.count}" th:onclick="|modifyParentCategory(${s.count})|">수정</button>
                            <button class="btn btn-outline-secondary" type="button" th:id="'add'+${s.count}" th:onclick="|addParentCategory(${s.count}, ${s.current.childCategories.size()})|">추가</button>
                            <button class="btn btn-outline-secondary" type="button" th:id="'delete'+${s.count}" th:onclick="|deleteParentCategory(${s.count})|">삭제</button>
                        </div>
                        <div class="input-group mb-3 ms-5" th:each="childCategories, ss : ${list.childCategories}" th:id="'child'+${s.count}+${ss.count}">
                            <input type="text" class="form-control" style="width: 80%"
                                   th:field="|${categoryList.testLists[__${s.index}__].childCategories[__${ss.index}__]}|"
                                   th:id="'category'+${s.count}+${ss.count}" readonly>
                            <button style="width: 10%" class="btn btn-outline-secondary" type="button" th:id="'modify'+${s.count}+${ss.count}" th:onclick="|modifyParentCategory(${s.count}${ss.count})|">수정</button>
                            <button style="width: 10%" class="btn btn-outline-secondary" type="button" th:id="'delete'+${s.count}+${ss.count}" th:onclick="|deleteCategory(${s.count},${ss.count})|">삭제</button>
                        </div>

                    </div>
                </th:block>
                <div class="row justify-content-evenly mt-4 mb-5 g-0">
                    <button class="btn btn-secondary" type="submit">저 장</button>
                </div>
            </form>
        </div>



    </div>

<!--    &lt;!&ndash; Admin Content &ndash;&gt;-->
<!--    <div class="admin-content">-->
<!--        <div class="button-group">-->
<!--            <a href="categoryAddForm.html" class="btn btn-big">Add Topic</a>-->
<!--            <a href="index.html" class="btn btn-big">Manage Topics</a>-->
<!--        </div>-->

<!--        <div class="content">-->
<!--            <h2 class="page-title">Manage Topics</h2>-->

<!--            <div class="category-list">-->
<!--                <ul>-->
<!--                    <li id="parent-list">-->
<!--                        <div class="category-list">-->
<!--                            <div class="child-list">Poetry</div>-->
<!--                            <div class="child-list">-->
<!--                                <a href="#" class="add" id="elem2">추가</a> <a href="#" class="delete">삭제</a>-->
<!--                            </div>-->
<!--                        </div>-->
<!--                    </li>-->
<!--                    <li id="parent-list2">-->
<!--                        <div class="category-list">-->
<!--                            <div class="child-list">Poetry</div>-->
<!--                            <div class="child-list">-->
<!--                                <a href="#" class="add">추가</a> <a href="#" class="delete">삭제</a>-->
<!--                            </div>-->
<!--                        </div>-->
<!--                    </li>-->
<!--                </ul>-->
<!--            </div>-->
<!--        </div>-->
<!--    </div>-->
<!--    &lt;!&ndash; // Admin Content End &ndash;&gt;-->

</section>
<!-- // Page Wrapper End -->

<script th:inline="javascript">
    let count = 0;
    function deleteParentCategory(num) {
        let element = document.getElementById('category'+num);
        let node = element.parentNode.parentNode;

        while (node.hasChildNodes()) {
            node.removeChild(
                node.firstChild
            );
        }
    };

    function deleteCategory(parent, child) {
        document.getElementById('child'+parent+child).remove();
    };

    function addParentCategory(num, size) {
        count++;
        let num2 = count + size;
        let element = document.getElementById('add'+num);
        let lastElementChild = element.parentNode.parentNode.lastElementChild.cloneNode(true);

        console.log(element.parentNode.parentNode.lastElementChild.id);

        if (element.parentNode.parentNode.lastElementChild.id === 'parent1') {
            let a = '';
            a += '            <div class="input-group mb-3 ms-5" id="child' + num + '1">\n' +
                '                <input type="text" class="form-control" style="width: 80%"\n' +
                '                       id="category' + num + '1" name="testLists[' + (num - 1) + '].childCategories[' + (num2 - 1) + ']">\n' +
                '                <button style="width: 10%" class="btn btn-outline-secondary" type="button" id="modify' + num + '1" onclick="modifyParentCategory(' + num + '1)">확인</button>\n' +
                '                <button style="width: 10%" class="btn btn-outline-secondary" type="button" id="deleteCategory(' + num + '1)" onclick="deleteCategory(' + num + ',1)">삭제</button>\n' +
                '            </div>';
            let parentNode = element.parentNode.parentNode;
            $(parentNode).append(a);
        } else {
            console.log('else = ' + count);
            console.log('num2 = ' + num2);

            lastElementChild.setAttribute('id', 'child' + num + num2);

            let htmlInputElement = document.createElement('input');
            htmlInputElement.setAttribute('class', 'form-control');
            htmlInputElement.setAttribute('style', 'width: 80%');
            htmlInputElement.setAttribute('id', 'category' + num + num2);
            htmlInputElement.setAttribute('name', 'testLists[' + (num - 1) + '].childCategories[' + (num2 - 1) + ']');
            htmlInputElement.readOnly = false;

            let htmlButtonElement = document.createElement('button');
            htmlButtonElement.setAttribute('style', 'width: 10%');
            htmlButtonElement.setAttribute('class', 'btn btn-outline-secondary');
            htmlButtonElement.setAttribute('id', 'modify' + num + num2);
            htmlButtonElement.setAttribute('type', 'button');
            htmlButtonElement.setAttribute('onclick', 'modifyParentCategory(' + num + num2 + ')');
            htmlButtonElement.innerHTML = '확인';

            let deleteElement = document.createElement('button');
            deleteElement.setAttribute('style', 'width: 10%');
            deleteElement.setAttribute('class', 'btn btn-outline-secondary');
            deleteElement.setAttribute('id', 'delete' + num + num2);
            deleteElement.setAttribute('type', 'button');
            deleteElement.setAttribute('onclick', 'deleteCategory(' + num + ',' + num2 + ')');
            deleteElement.innerHTML = '삭제';



            lastElementChild.replaceChild(htmlInputElement, lastElementChild.childNodes[1]);
            lastElementChild.replaceChild(htmlButtonElement, lastElementChild.childNodes[3]);
            lastElementChild.replaceChild(deleteElement, lastElementChild.childNodes[5]);
            console.log(lastElementChild.childNodes);
            console.log(lastElementChild);

            element.parentNode.parentNode.appendChild(lastElementChild);
        }
    }

    function modifyParentCategory(id) {
        let elem = document.getElementById('category'+id);
        let buttonElem = document.getElementById('modify'+id);

        if (buttonElem.innerText === '수정') {
            elem.readOnly = false;
            buttonElem.innerHTML = '확인';
        } else {
            elem.readOnly = true;
            buttonElem.innerHTML = '수정';
        }
    }


</script>
</html>