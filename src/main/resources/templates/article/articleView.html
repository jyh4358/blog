<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/thymeleaf-extras-springsecurity5"
      th:replace="~{/layout/layout :: layout(~{::title}, ~{::section}, ~{::script})}">


<title>JDong's Blog</title>

<section>

        <div class="main ">
            <div class="carousel-inner ">
                <div class="carousel-item active" style="cursor: default">
                    <img th:src="${articleDetailResponse.thumbnailUrl}" class="w-100 vh-100 cover main-image"
                         alt="...">
                    <div class="card-img-overlay text-shadow text-white text-center row justify-content-center align-content-center p-0">
                        <h1 style="font-size: 2.5rem;" th:text="${articleDetailResponse.title}">아티클 제목</h1>
                        <h5 th:text="|작성일 : ${#temporals.format(articleDetailResponse.createDate, 'yyyy-MM-dd HH:mm')}">작성일</h5>
                    </div>
                </div>
            </div>

            <div class="mt-5 ms-2 me-2 ms-sm-5 me-sm-5 mt-sm-5 d-flex justify-content-center">

                <div class="paper">

                    <div class="container p-3 p-sm-5">
                        <div class="toastui-editor-contents"
                             th:utext="${articleDetailResponse.content}">
                            내요오오오오옹
                            내요오오오오옹
                            내요오오오오옹
                            내요오오오오옹
                            내요오오오오옹
                            내요오오오오옹
                            내요오오오오옹
                            내요오오오오옹
                            내요오오오오옹
                            내요오오오오옹
                        </div>
                    </div>

                    <div class="ms-2 me-2 mb-3 p-sm-4 p-2">
                        <div class="toolbox container pt-4 pb-4">
                            <div class=" ms-5 me-5 d-flex justify-content-end">

                                <button class="btn btn-secondary ms-2" data-bs-toggle="modal"
                                        data-bs-target="#shareContent">
                                    <i class="fas fa-share-alt"></i></button>

                                <div class="modal fade " id="shareContent" tabindex="-1" aria-labelledby="shareContent"
                                     aria-hidden="true">
                                    <div class="modal-dialog modal-dialog-centered">
                                        <div class="modal-content">
                                            <div class="modal-header">
                                                <h5 class="modal-title" id="shareContentModalLabel">공유하기</h5>
                                                <button type="button" class="btn-close" data-bs-dismiss="modal"
                                                        aria-label="Close"></button>
                                            </div>
                                            <div class="modal-body">
                                                <div class="list-unstyled social-icon-wrap d-flex justify-content-around">
                                                    <a class="social-icon link-icon-facebook">
                                                        <i class=" fa fa-facebook"></i>
                                                    </a>
                                                    <a class="social-icon link-icon-kakao">
                                                        <i class="fa fa-comment"></i>
                                                    </a>
                                                    <a class="social-icon link-icon-naver">
                                                    </a>
                                                </div>

                                            </div>
                                        </div>
                                    </div>
                                </div>

                            </div>
                            <div></div>
                            <div class="toolbox-head mt-3 ms-5 me-5">
                                <a th:text="${articleDetailResponse.category}">카테고리</a>
                                <span></span></div>
                            <ul class="row row-cols-1 row-cols-sm-2 mt-2 ms-5 me-5 toolList">

                                <th:block th:each="simpleArticle : ${articleDetailResponse.simpleArticles}">
                                    <li class="col text-block otherArticle">
                                        <a th:href="@{/article/{articleId}(articleId=${simpleArticle.id})}"
                                           th:text="${simpleArticle.title}">글목록</a>
                                    </li>
                                </th:block>

                            </ul>
                            <div class="mt-2 ms-5 me-5">
                                <a class="me-2" th:each="tag : ${articleDetailResponse.tags}"
                                   th:href="@{/article/list/tag}">
                                    <button class="badge rounded-pill bg-secondary" th:text="${tag}">태그</button>
                                </a>
                            </div>
                        </div>
                    </div>

                </div>


            </div>


            <!-- comment s -->
            <hr class="py-1" style="color: rgb(212, 200, 184);">

            <div class="container mt-2 mb-5" style="max-width: 1200px;">

                <div class="ms-2 me-2 mt-3 d-flex align-items-center">
                    <div sec:authorize="isAuthenticated()">
                        <img th:src="${#authentication.principal.getThumbnailUrl()}" width="50"
                             height="50"
                             class="rounded-circle me-2">
                    </div>

                    <div sec:authorize="isAnonymous()">
                        <img src="/images/guest.png" width="50"
                             height="50"
                             class="rounded-circle me-2">
                    </div>
                    <textarea type="text" id="commentContent" name="commentContent"
                              class="form-control"></textarea>
                </div>
                <div class="d-flex">

                    <div class="ms-1 mt-2 secretBox">
                        <label class="lock">
                            <input type="checkbox" id="isCommentSecret" value="secret"/>
                            <span></span>
                        </label>
                    </div>

                    <div class="ms-auto mt-2 me-2">
                        <button class="btn btn-secondary btn-sm" onclick="commentWrite()">등 록</button>
                    </div>
                </div>

                <div class="row justify-content-center align-items-center g-0 wow fadeInUp p-2">
                    <div class="col">
                        <div id="commentContainer">

                            <!-- comment 자바스크립트로 작성 -->
                            <div class="mt-2 comment-box" id="commentBox">

                                <!-- 추가 -->
                                <div class="d-flex flex-row p-2">
                                    <div>
                                        <img src="https://lh3.googleusercontent.com/a-/AOh14GjlNntJFO-WEcQxmjjZ1EmAkkOA4EVnK6XjSNZQ=s96-c"
                                             width="40" height="40" class="rounded-circle me-2" alt="">
                                    </div>
                                    <div class="w-100">
                                        <div class="d-flex justify-content-between align-items-center">
                                            <span class="me-2">갈메기#11271</span>
                                            <div class="d-flex flex-row align-items-center">
                                                <small>21-12-19 02:19:34</small>
                                            </div>
                                        </div>
                                        <p class="text-justify comment-text mb-0" style="white-space:pre-wrap;">훌륭한
                                            사이트입니다.</p>
                                        <div class="comment-reply">
                                            <div style="background-color: #ebebeb;">
                                                <button class="btn align-items-center rounded collapsed"
                                                        data-bs-toggle="collapse" data-bs-target="#comment-reply-1"
                                                        aria-expanded="false">
                                                    <i class="fa fa-comments-o me-2" aria-hidden="true"></i> 대댓글
                                                </button>
                                            </div>
                                            <div class="d-flex flex-row p-2">
                                                <div>
                                                    <img src="https://lh3.googleusercontent.com/a/AATXAJxV7ep_Ia3D5NI5DBoYSvRGoejQWIMEAlKTWqLzRA=s96-c"
                                                         width="40" height="40" class="rounded-circle me-2" alt="">
                                                </div>
                                                <div class="w-100">
                                                    <div class="d-flex justify-content-between align-items-center">
                                                        <span class="me-2">지니아#10396</span>
                                                        <div class="d-flex flex-row align-items-center">
                                                            <small>21-12-19 15:24:36</small>
                                                        </div>
                                                    </div>
                                                    <p class="text-justify comment-text mb-0"
                                                       style="white-space:pre-wrap;">감사합니다</p>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                            </div>



                            <!--  -->

                        </div>
                    </div>
                </div>


            </div>

    </div>
    <div th:text="${#authentication.principal.member.id}"></div>
</section>

<!-- Slick Carousel -->
<script type="text/javascript" src="https://cdn.jsdelivr.net/npm/slick-carousel@1.8.1/slick/slick.min.js"></script>
<script src="/css/tagify.js"></script>
<script src="/js/getCsrf.js"></script>
<script th:inline="javascript" type="application/javascript">

    let commentIndex = {
        init: function () {
            let _this = this;
            _this.getCommentList();
        },
        getCommentList: function () {
            let token = getCsrfToken();
            console.log(typeof [[${articleDetailResponse.id}]])
            let data = {
                articleId: [[${articleDetailResponse.id}]]
            };

            $.ajax({
                type: 'GET',
                url: '/api/v1/article/' + [[${articleDetailResponse.id}]] + '/comments',
                headers: {'X-XSRF-TOKEN': token},
                async: false
            }).done(function (res) {
                makeComment(res);
            }).fail(function (error) {
                alert(JSON.stringify(error));
            });
        },

    }
    commentIndex.init();

    function makeComment(res) {

        let newVar = [[${#authentication.principal.member.id}]];
        console.log(newVar);



        console.log(res)
    }
</script>
</html>